(function(){var a,b,c,d,e,f,g,h,i,j,k=[].slice;c=function(a){return a},i=function(a){return a.length>0},g=function(b){return b instanceof a.Property},e=function(a){return a instanceof Array},h=function(a){return"object"==typeof a},f=function(a,b){return a===b},b=function(a,b,c){var d,e,f;for(d=0,e=a.length;e>d;d++)f=a[d],b=c(b,f);return b},j=function(a,b,c){var d,f,g;d=e(a)?[]:{};for(f in a)g=a[f],d[f]=g;return null!=b&&(d[b]=c),d},d=function(a){var d,e,l,m,n;return l=a._,m=1,e=a.Model=function(b){var g,h,i,k,o,p;return k=m++,g=void 0,i=new a.Bus,o=new a.Bus,p=a.update({initial:!0},[i],function(a,b){var c,d,e,f,g,h;return h=a.value,g=b.source,d=b.f,f=d(h),e=[k],c=f!==h,{source:g,value:f,modStack:e,changed:c}},[o],function(a,b){return b}).filter("!.initial").skipDuplicates(f).changes().toProperty(),h=p.map(".value").skipDuplicates(f),h.dispatcher.subscribe(function(a){return a.hasValue()?g=a.value():void 0}),h.id||(h.id=k),h.addSyncSource=function(a){var b;return b=a.filter(function(a){return a.changed&&!l.contains(a.modStack,k)}).map(function(a){return j(a,"modStack",a.modStack.concat([k]))}).map(function(a){return n.set(a,h.syncConverter(n.get(a)))}),o.plug(b)},h.apply=function(a){return i.plug(a.toEventStream().map(function(b){return{source:a,f:b}})),p.changes().filter(function(b){return b.source!==a}).map(function(a){return a.value})},h.addSource=function(a){return h.apply(a.map(function(a){return function(){return a}}))},h.modify=function(b){return h.apply(a.once(b))},h.set=function(a){return h.modify(function(){return a})},h.get=function(){return g},h.syncEvents=function(){return p.toEventStream()},h.bind=function(a){return this.addSyncSource(a.syncEvents()),a.addSyncSource(this.syncEvents())},h.lens=function(a){var b;return a=d(a),b=e(),this.addSyncSource(h.sampledBy(b.syncEvents(),function(b,c){return n.set(c,a.set(b,c.value))})),b.addSyncSource(this.syncEvents().map(function(b){return n.set(b,a.get(b.value))})),b},h.syncConverter=c,arguments.length>=1&&h.set(b),h},e.combine=function(a){var b,c,f,i,j,k;if(h(a)){if(g(a))return a;b=a instanceof Array?[]:{},j=e(b);for(c in a)k=a[c],f=d.objectLens(c),i=j.lens(f),i.bind(e.combine(k));return j}return e(a)},a.Binding=function(a){var b,c,d,f,g,h;return d=a.initValue,c=a.get,b=a.events,h=a.set,f=b.map(c),null!=d?h(d):d=c(),g=e(d),g.addSource(f).assign(h),g},a.localStorageProperty=function(b){var c;return c=function(){return localStorage.getItem(b)},a.Binding({initValue:c(),get:c,events:a.never(),set:function(a){return localStorage.setItem(b,a)}})},d=a.Lens=function(a){return h(a)?a:d.objectLens(a)},d.id=d({get:function(a){return a},set:function(a,b){return b}}),d.objectLens=function(a){var b,c;return c=function(a){return d({get:function(b){return null!=b?b[a]:void 0},set:function(b,c){return j(b,a,c)}})},b=l.filter(i,a.split(".")),d.compose.apply(d,l.map(c,b))},d.compose=function(){var a,c;return a=1<=arguments.length?k.call(arguments,0):[],c=function(a,b){return d({get:function(c){return b.get(a.get(c))},set:function(c,d){var e,f;return e=a.get(c),f=b.set(e,d),a.set(c,f)}})},b(a,d.id,c)},n=d.objectLens("value"),a},"undefined"!=typeof module&&null!==module&&null!=module.exports?(a=require("baconjs"),module.exports=d(a)):"function"==typeof define&&define.amd?define(["bacon"],d):d(this.Bacon)}).call(this);